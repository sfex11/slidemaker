# 슬라이드 SaaS 재개발 계획서 (Codex 계획2)

## 전제 (고정 기술, 현재 기준)

- 서버: Bun + Express + TypeScript (모놀리식)
- 클라이언트: Vite + React + React Router + Tailwind
- 데이터베이스: Prisma + SQLite
- 템플릿/덱 엔진: `svg-slide-maker` 템플릿(`templates/*.html`) + 서버 렌더링 모듈
- 인증: 이메일/비밀번호 + Bearer 토큰 세션
- 배포: Oracle Free Tier 단일 VM 기준 (저사양)

이 문서는 기존 계획의 `3. 기술안`을 폐기하고, 위 고정 스택으로 전체를 다시 설계한다.

---

## 1. 목표

1. `svg-slide-maker`의 핵심 가치(템플릿 품질, 슬라이드 구조화, HTML/SVG 결과물)를 웹서비스에서 안정적으로 제공한다.
2. 저사양 Oracle Free Tier에서도 느리지만 끊기지 않는 사용자 경험을 만든다.
3. 웹주소(URL)/PDF/마크다운 입력에서 슬라이드 자동 생성까지의 핵심 흐름을 우선 완성한다.
4. 편집 없이 바로 결과를 받을 수 있는 자동 생성 경험과 HTML 내보내기를 최우선으로 완성한다.
5. 운영 복잡도를 최소화해 장애 대응이 쉬운 단일 프로세스 중심 구조를 유지한다.
6. 기능 추가보다 “메모리 안정성, 응답 일관성, 복구 가능성”을 우선 KPI로 둔다.

---

## 2. 전략

### 2.1 아키텍처 전략 (저성능 우선)

- 모놀리식 유지: API/렌더링/인증을 단일 서버 프로세스로 운영한다.
- 비동기 최소화: 외부 큐(예: Redis/BullMQ) 없이 DB 상태 기반 간단 작업 모델로 처리한다.
- 계산량 제한: 요청당 토큰/슬라이드 수/응답 크기 상한을 강제한다.
- 메모리 보호: 큰 문서 파싱과 HTML 생성은 크기 제한 + 타임아웃 + 실패 폴백을 기본 적용한다.
- 의존성 축소: 운영에 필수 아닌 라이브러리와 백그라운드 프로세스는 도입하지 않는다.

### 2.2 성능/안정성 전략

- “빠름”보다 “안정 완료”를 목표로 한다.
- API 응답 목표:
- 인증/목록 API: P95 300ms 이내
- 프로젝트 단건 조회: P95 600ms 이내
- 생성/내보내기 API: 3~12초 허용 (진행 상태 표시)
- 요청 보호:
- 본문 크기 제한
- 외부 URL fetch 타임아웃
- 동시 생성 작업 사용자당 1개 제한
- 장애 격리:
- AI 호출 실패 시 기본 슬라이드 폴백
- 템플릿 파싱 실패 시 `default` 강제 fallback
- DB 잠금/오류 시 재시도 1회 + 사용자 안내 메시지

### 2.3 제품 전략 (단계적 재개발)

- 1단계: “생성-HTML내보내기” 단일 가치사슬 완성 (편집은 선택 기능)
- 2단계: 품질 개선(템플릿 확장, 생성 정확도, 실패 복구 UX)
- 3단계: 무거운 기능(PPTX, 협업)은 서버 여유와 수요 확인 후 도입
- 기술부채 전략:
- 우선 기능을 붙이고, 타입/테스트/로그를 병행 보강
- 릴리즈마다 느린 쿼리/큰 payload를 계측하고 상한값 조정

### 2.4 운영 전략

- 배포 단순화: 단일 서비스 + 정적 파일 서빙
- 로그 우선순위:
- 인증 실패
- AI 생성 실패
- 내보내기 실패
- 외부 URL 차단(보안 이벤트)
- 백업/복구:
- SQLite 파일 일일 백업
- 최근 7일 롤백 보관
- 변경 배포 원칙:
- 데이터 스키마 변경은 항상 백워드 호환 우선
- 기능 토글로 단계적 공개

### 2.5 보안 전략

- 리소스 소유권 검증은 모든 update/delete/export API에 강제
- URL 입력은 SSRF 차단 정책 유지
- CORS 화이트리스트 유지
- 세션 만료/정리 루프 유지
- 입력 검증 실패를 400 계열로 명확히 분리

---

## 4. 기능안 (재개발 범위)

### 4.1 P0 (반드시 완성)

- 인증
- 로그인/로그아웃/세션확인
- 토큰 기반 보호 라우트
- 프로젝트
- 생성/조회/삭제 중심
- 슬라이드 저장(JSON content) + 자동 생성 결과 보존
- 생성 파이프라인
- 입력: URL, PDF, 마크다운
- AI 변환 + 실패 폴백
- 슬라이드 타입 매핑(title/card-grid/comparison/timeline/quote/table)
- PDF 처리
- 파일 업로드(base64 또는 multipart) → 텍스트 추출 → 구조화
- 대용량 PDF는 자동 요약 단계 적용
- 템플릿/내보내기
- 템플릿 목록 조회 (`svg-slide-maker/templates`)
- 선택 템플릿으로 HTML deck 생성
- 브라우저 파일 다운로드

### 4.2 P1 (MVP 직후)

- 생성 품질 개선
- 입력 문서 전처리(헤딩/불릿/표 추출 강화)
- 슬라이드 수 자동 튜닝(문서 길이 기반)
- 편집 기능(선택 기능) 확대
- 카드/표/타임라인 항목 미세 수정 UX
- 슬라이드 복제/재정렬 기능
- 템플릿 기능 확대
- 템플릿 미리보기 썸네일
- 프로젝트별 기본 템플릿 저장
- 운영 기능
- 작업 실패 재시도 버튼
- 생성 이력(최근 N개)

### 4.3 P2 (서버 여유 확인 후)

- 고급 내보내기
- PDF 출력
- PNG 이미지 시퀀스 출력
- 협업 최소 기능
- 공유 링크(읽기 전용)
- 댓글/동시편집은 보류

### 4.4 API 재정의 (현재 스택 기준)

- 인증
- `POST /api/auth/login`
- `POST /api/auth/logout`
- `GET /api/auth/me`
- 프로젝트/슬라이드
- `GET /api/projects`
- `POST /api/projects`
- `GET /api/projects/:id`
- `PUT /api/projects/:id`
- `DELETE /api/projects/:id`
- `POST /api/projects/:projectId/slides`
- `PUT /api/slides/:id`
- `DELETE /api/slides/:id`
- 생성
- `POST /api/generate/from-url`
- `POST /api/generate/from-pdf`
- `POST /api/generate/from-markdown`
- 템플릿/내보내기
- `GET /api/svg/templates`
- `POST /api/projects/:id/export/html`

### 4.5 데이터 모델 (현재 DB 중심)

- `User`: 계정/인증 정보
- `Project`: 사용자 소유 프로젝트
- `Slide`: 프로젝트 하위 슬라이드(JSON content, order)
- 확장 예정 필드:
- `Project.templateId` (기본 템플릿)
- `Project.lastExportedAt`
- `Project.status` (idle/generating/failed)

### 4.6 수용 기준 (Acceptance Criteria)

- 로그인 사용자 기준으로 본인 프로젝트만 수정/삭제/내보내기 가능
- URL 입력 생성은 SSRF 차단 정책 위반 시 즉시 거부
- URL/PDF/마크다운 3가지 입력 경로에서 자동 생성이 동일 품질 기준으로 동작
- 내보내기 시 선택 템플릿이 실제 HTML 결과에 반영
- 서버 재시작 후에도 프로젝트/슬라이드 데이터가 유지
- 타입체크/빌드/기본 테스트가 CI에서 통과

### 4.7 단계별 일정 (현실적 재개발)

- 주 1: 도메인/API 정리, 스키마 정리, 보안/검증 공통화
- 주 2: URL/PDF/마크다운 자동 생성 파이프라인 완성 + 실패 폴백 정교화
- 주 3: 템플릿 선택 + HTML 내보내기 완성, 운영 로그/백업 체계
- 주 4: 생성 품질 개선 착수 (슬라이드 매핑, 템플릿 적용 정확도, 실패 복구 UX)
- 주 5: 선택형 편집 기능(P1) 착수

---

## 결론

재개발의 핵심은 “기술 스택 확대”가 아니라 “현재 스택으로 안정적인 완결 경험을 제공”하는 것이다.
Oracle Free Tier 제약을 전제로, 단일 서버 구조에서 URL/PDF/마크다운 자동 생성-내보내기를 먼저 완성하고 점진 확장한다.
